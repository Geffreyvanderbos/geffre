{{ define "main" }}
    <main>
        <div class="main-content">
        {{- $allPages := where .Site.Pages.ByDate.Reverse "Type" "post" }}
        {{- $home_categories := slice }}
        {{- if .Site.Params.home_category }}
            {{- range split .Site.Params.home_category "," }}
                {{- $home_categories = $home_categories | append (trim . " ") }}
            {{- end }}
        {{- end }}
        {{- $pages := $allPages }}
        {{- if $home_categories }}
            {{- $pages = where $allPages "Params.categories" "intersect" $home_categories }}
        {{- end }}
        {{- $paginator := .Paginate $pages (index .Site.Params "archive-paginate" | default 20) }}
        {{- range $paginator.Pages  }}
        <div class="transition-holder" style="view-transition-name: post-{{ .Params.post_id }}">
            <article class="h-entry {{ range $index, $category := .Params.categories }}{{ if gt $index 0 }} {{ end }}{{ $category | lower | urlize }}{{ end }}" data-time="{{ .Date.Format "15:04" }}">
            {{- if .Title }}
            <h2 class="post__title"><a href="{{ .Permalink }}" class="u-url">{{ .Title | safeHTML }}</a></h2>
                <p>{{ .Summary | safeHTML }} <a href="{{ .Permalink }}" class="u-url">&hellip;read more</a></p>
                <div class="post__metadata">
                    <time class="dt-published" datetime="{{ .Date.Format "2006-01-02 15:04:05 -0700" }}">
                        <a href="{{ .Permalink }}" class="u-url">{{ .Date | time.Format ":date_full" }}</a>
                    </time>
                </div>
            {{- else if in .RawContent "<!--more-->"}}
                <div class="post__metadata">
                    <time class="dt-published" datetime="{{ .Date.Format "2006-01-02 15:04:05 -0700" }}">
                        <a href="{{ .Permalink }}" class="u-url">{{ .Date | time.Format ":date_full" }}</a>
                    </time>
                </div>
                <p>{{ .Summary | safeHTML }}{{- if .Truncated }} <a href="{{ .Permalink }}" class="u-url">read more</a></p>
                <p><a href="{{ .Permalink }}" class="u-url">&hellip;read more</a></p>
                {{- end }}
            {{- else }}
            {{ .Content }}
                <div class="post__metadata">
                    <time class="dt-published" datetime="{{ .Date.Format "2006-01-02 15:04:05 -0700" }}">
                        <a href="{{ .Permalink }}" class="u-url">{{ .Date | time.Format ":date_full" }}</a>
                    </time>
                </div>
            {{- end }}
            </article>
            </div>
            {{- end }}
        {{- if or ($paginator.HasNext) ($paginator.HasPrev) }}
        <nav class="feed-nav">
            <ul class="feed-nav__ul">
                {{ if $paginator.HasNext }}<li><a href="{{ $paginator.Next.URL }}">← Older posts</a></li>{{ end }}
                {{ if $paginator.HasPrev }}<li><a href="{{ $paginator.Prev.URL }}">Newer posts →</a></li>{{ end }}
            </ul>
        </nav>
        {{- end }}
        </div>
</div>
{{ end }}
